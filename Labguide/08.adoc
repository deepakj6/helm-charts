= Resource Quotas
:stylesheet: boot-flatly.css
:nofooter:
:data-uri:
:icons: font
:linkattrs:

This lab consists of a list of exercises to demonstrate and understand
the most commonly used kubernetes commands and concepts to ramp up your kubernetes competency skills in the area of `Resource Quotas`



== Learning Outcomes
After completing the lab, you will be able to understand and use Kubernetes concepts related to the below topics:

. Resource Quota
. Namespaces
. Service Accounts for security


=== Start the minikube

. Start minikube locally
`minikube start --driver=virtualbox`

. Verify the kubectl context `kubectl config get-contexts` is set to minikube. If not, set it to minikube `kubectl config use-context minikube`

[NOTE]
====
Create all manifest resources in the directory `~/workspace/kubernetes-manifests/competencies`. Watch out for the right file names in the solution section.
====
=== Namespaces & ResourceQuotas


**All the exercises in this section has to be completed in minikube & not on production cluster**

. Create a namespace called alpha imperatively

+

.Click to see solution
[%collapsible]
====

[source, shell script]
------------------
kubectl create namespace alpha
------------------

[source, shell script]
------------------
kubectl delete namespace alpha
------------------
====


. Create a namespace called angel declaratively

+

.Click to see solution
[%collapsible]
====
`~/workspace/kubernetes-manifests/competencies/namespace/ns-1.yaml`
[source, yaml]
------------------
apiVersion: v1
kind: Namespace
metadata:
  name: angel
------------------

[source, shell script]
------------------
kubectl apply -f ~/workspace/kubernetes-manifests/competencies/namespace/ns-1.yaml
kubectl get ns
------------------

[source, shell script]
------------------
kubectl delete ns angel
------------------
====

. Create a resource quota in the namespace alpha with the below requirement. After creating the quota, Create an nginx pod within alpha and should you get an error, try to troubleshoot and solve it

+
[source, yaml]
-------------
pods:5
"requests.cpu": "2"
"requests.memory": 1024m
"limits.cpu": "4"
"limits.memory": 2048m
-------------

+

.Click to see solution
[%collapsible]
====

`~/workspace/kubernetes-manifests/competencies/resource-quota.yaml`
[source, yaml]
------------------
apiVersion: v1
kind: ResourceQuota
metadata:
  name: resource-quota
  namespace: [student-name]
spec:
  hard:
    cpu: 2
    memory: 2Gi
    pods: 5
------------------

[source, shell script]
------------------
kubectl apply -f ~/workspace/kubernetes-manifests/competencies/resource-quota.yaml
kubectl get resourcequota
------------------

[source, shell script]
------------------
kubectl delete rs resource-quota
------------------
====

=== ServiceAccount

. Create a secret called `docker-registry` of type `generic` in the namespace that you are currently working in.
Use this secret to apply to all the pods in such a way that these credentials will be used by kubernetes while pulling images from dockerhub.
One way to do that is by means of a patch operation updating the service account for the corresponding namespace.


+

.Click to see solution
[%collapsible]
====
[source, shell script]
------------------
docker logout
docker login
------------------

[source, shell script]
------------------
cp ~/.docker/config.json config.json
kubectl create secret generic docker-registry \
    --from-file=.dockerconfigjson=config.json \
    --type=kubernetes.io/dockerconfigjson -n default
------------------

[source, shell script]
------------------
kubectl get serviceaccount default -o yaml -n default
kubectl patch serviceaccount default -p '{"imagePullSecrets": [{"name": "docker-registry"}]}' -n default
kubectl get serviceaccount default -o yaml -n default
rm config.json
------------------
====